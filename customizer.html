<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØµÙØ­Ø© ØªØ®ØµÙŠØµ Ù…Ù†ØµØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { direction: rtl; text-align: center; font-family: 'Tajawal', sans-serif; }
    input, select { padding: 6px; margin: 8px; max-width: 280px; width: 90%; }
    button { padding: 10px 20px; margin-top: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>ØªØ®ØµÙŠØµ Ù…Ù†ØµØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</h1>

  <div id="step1">
    <p>Ù„ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ù†ØµØ©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø³Ø§Ø¨ GitHub Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.</p>
    <button onclick="startDeviceFlow()">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ GitHub</button>
    <div id="deviceInfo" class="hidden">
      <p>ÙŠØ±Ø¬Ù‰ Ø²ÙŠØ§Ø±Ø©: <a href="https://github.com/login/device" target="_blank">github.com/login/device</a></p>
      <p>ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ:</p>
      <h2 id="user_code"></h2>
    </div>
  </div>

  <div id="customizerForm" class="hidden">
    <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®ØµÙŠØµ</h2>
    <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø© ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ‚:</label><br>
    <input type="text" id="footerEntityName" value="Ø¬Ù…Ø¹ÙŠØ© ÙØ²Ø¹Ø© Ù„Ù„Ø¥ØºØ§Ø«Ø© Ø¨Ø§Ù„Ø²Ù„ÙÙŠ"><br>

    <label>Ø§Ù„Ø³Ù†Ø© ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ‚:</label><br>
    <input type="text" id="footerYear" value="2025"><br>

    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©:</label><br>
    <input type="text" id="pageTitle" value="Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹ÙŠØ¯ - ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ±"><br>

    <label>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© (Ù…Ø«Ø§Ù„: Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±):</label><br>
    <input type="text" id="occasionText" value="Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±"><br>

    <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©:</label><br>
    <input type="color" id="backgroundColor" value="#f9f9f9"><br>

    <label>Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±:</label><br>
    <input type="color" id="buttonColor" value="#006699"><br>

    <label>Ø¹Ø¯Ø¯ Ø§Ù„ØªØµØ§Ù…ÙŠÙ…:</label><br>
    <input type="number" id="designCount" value="6" min="1" max="20"><br>

    <button onclick="saveConfigToGitHub()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ®ØµÙŠØµ ÙÙŠ GitHub</button>
  </div>

  <script>
    const client_id = "YOUR_CLIENT_ID"; // Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù…Ø¹Ø±Ù ØªØ·Ø¨ÙŠÙ‚Ùƒ Ù…Ù† GitHub
    let device_code = "";
    let access_token = "";
    let username = "";

    async function startDeviceFlow() {
      const res = await fetch("https://github.com/login/device/code", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `client_id=${client_id}&scope=repo`
      });
      const data = await res.json();
      device_code = data.device_code;
      document.getElementById("user_code").textContent = data.user_code;
      document.getElementById("deviceInfo").classList.remove("hidden");

      pollAccessToken(data.interval);
    }

    async function pollAccessToken(interval) {
      const poll = setInterval(async () => {
        const res = await fetch("https://github.com/login/oauth/access_token", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded", "Accept": "application/json" },
          body: `client_id=${client_id}&device_code=${device_code}&grant_type=urn:ietf:params:oauth:grant-type:device_code`
        });
        const data = await res.json();
        if (data.access_token) {
          clearInterval(poll);
          access_token = data.access_token;
          document.getElementById("customizerForm").classList.remove("hidden");
          document.getElementById("step1").classList.add("hidden");
          getUserInfo();
        }
      }, interval * 1000);
    }

    async function getUserInfo() {
      const res = await fetch("https://api.github.com/user", {
        headers: { Authorization: `token ${access_token}` }
      });
      const data = await res.json();
      username = data.login;
    }

    async function saveConfigToGitHub() {
      const config = {
        logoType: "image",
        logoImageHeight: 180,
        logoText: "Ø¬Ù‡Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©",
        logoTextColor: "#006699",
        logoTextFont: "Tajawal",
        logoTextSize: 24,
        occasionText: document.getElementById("occasionText").value,
        pageTitle: document.getElementById("pageTitle").value,
        backgroundColor: document.getElementById("backgroundColor").value,
        buttonColor: document.getElementById("buttonColor").value,
        footerEntityName: document.getElementById("footerEntityName").value,
        footerYear: document.getElementById("footerYear").value,
        visitorBadgeBase: "eid99999-cards",
        enableVisitorBadge: true,
        designCount: parseInt(document.getElementById("designCount").value)
      };

      const content = `const config = ${JSON.stringify(config, null, 2)};`;
      const base64Content = btoa(unescape(encodeURIComponent(content)));

      const repo = "eid-cards"; // Ø§Ø³Ù… Ø§Ù„Ø±ÙŠØ¨Ùˆ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
      const file = "config.js";

      // Ù†Ø¬ÙŠØ¨ SHA Ù„Ù„Ù…Ù„Ù
      const resMeta = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${file}`, {
        headers: { Authorization: `token ${access_token}` }
      });
      const meta = await resMeta.json();
      const sha = meta.sha;

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù
      const resUpdate = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${file}`, {
        method: "PUT",
        headers: { Authorization: `token ${access_token}` },
        body: JSON.stringify({
          message: "ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®ØµÙŠØµ Ù…Ù† customizer.html",
          content: base64Content,
          sha: sha
        })
      });

      if (resUpdate.ok) {
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ®ØµÙŠØµ Ø¨Ù†Ø¬Ø§Ø­!");
      } else {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø³Ù… eid-cards Ø¯Ø§Ø®Ù„ Ø­Ø³Ø§Ø¨Ùƒ.");
      }
    }
  </script>
</body>
</html>
